#!/usr/bin/env ruby

require 'openssl'

compliant = <<-COMPLIANT
-----BEGIN CERTIFICATE-----
MIIDVzCCAj+gAwIBAgIJAMXhmW2H4rU0MA0GCSqGSIb3DQEBCwUAMEIxCzAJBgNV
BAYTAlhYMRUwEwYDVQQHDAxEZWZhdWx0IENpdHkxHDAaBgNVBAoME0RlZmF1bHQg
Q29tcGFueSBMdGQwHhcNMTkwNTI3MTUzMDU0WhcNMjAwNTI2MTUzMDU0WjBCMQsw
CQYDVQQGEwJYWDEVMBMGA1UEBwwMRGVmYXVsdCBDaXR5MRwwGgYDVQQKDBNEZWZh
dWx0IENvbXBhbnkgTHRkMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA
wiiWr0JesxM4e0YVsWz0wAAoYrw2TIaHwg0hZVeX6R1NOLfApeDAbLLsEzO2G9Tj
6IuzxaMYzpRCJoSxe7iyttY9M6Z/OmlidMeBscRrEgR0YfSUC5szl4zHs3o1eML2
VAUYgmFu/nTrvPiznrIyLuPT/GrDKqZvKyj9h4/YX6oE+DeXGbdJ2Z9o3dXxlSgJ
8c6gqU+7IUkSO7CTpm4q3w/vHCFB+XfgJ6VJ3g2sSlsWM/Pmax47g14I+UgsFMGj
G0n4T6Nv6Kgen3GXUGfBoqtlBYpDQHcQljWXhuXQynnzSwDBYJkychIhpnuxjtn4
RZV1h5TrRqPDEuKC/zxKoQIDAQABo1AwTjAdBgNVHQ4EFgQUDJdr9taJqUSJh0uX
9oanZJlx5ewwHwYDVR0jBBgwFoAUDJdr9taJqUSJh0uX9oanZJlx5ewwDAYDVR0T
BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEARGsherQt9G7xaZ/EKCarZDhOCVqV
UXSZ4vkIEdPsNpvsPq07MPlMt9dePvcrtwlpy9JzxT3YSDOkJGIL71WrzRr4xCSr
J9FqB64beHKjYgiZ1eJiLYveRBXBnDzpLfctjzT4r0xwnZjnFfbNHRnpO9tz4sc0
e80j3yG1968u+8LhShd3Jl/3AY/g3+VgzGuAPgLYzAObHigWS8yME9HPBBHAIeKx
kXwZ4hiDaBh6q3UXD0IgSp3V7izQK3ScM2PDyrFDsLEg+R7YdnofWCbMiTc3uEVC
q/+dXqnGIeBzb4BrV0iYsbxCEdR6b9cF2ACoycFSs5nFLxz906yAvdeoFA==
-----END CERTIFICATE-----
COMPLIANT

noncompliant = <<NONCOMPLIANT
-----BEGIN CERTIFICATE-----
MIIDVzCCAj+gAwIBAgIJAMXhmW2H4rU0MA0GCSqGSIb3DQEBCwUAMEIxCzAJBgNV
BAYTAlhYMRUwEwYDVQQHDAxEZWZhdWx0IENpdHkxHDAaBgNVBAoME0RlZmF1bHQg
Q29tcGFueSBMdGQwHhcNMTkwNTI3MTUzMDU0WhcNMjAwNTI2MTUzMDU0WjBCMQsw
CQYDVQQGEwJYWDEVMBMGA1UEBwwMRGVmYXVsdCBDaXR5MRwwGgYDVQQKDBNEZWZh
dWx0IENvbXBhbnkgTHRkMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA
wiiWr0JesxM4e0YVsWz0wAAoYrw2TIaHwg0hZVeX6R1NOLfApeDAbLLsEzO2G9Tj
6IuzxaMYzpRCJoSxe7iyttY9M6Z/OmlidMeBscRrEgR0YfSUC5szl4zHs3o1eML2
VAUYgmFu/nTrvPiznrIyLuPT/GrDKqZvKyj9h4/YX6oE+DeXGbdJ2Z9o3dXxlSgJ
8c6gqU+7IUkSO7CTpm4q3w/vHCFB+XfgJ6VJ3g2sSlsWM/Pmax47g14I+UgsFMGj
G0n4T6Nv6Kgen3GXUGfBoqtlBYpDQHcQljWXhuXQynnzSwDBYJkychIhpnuxjtn4
RZV1h5TrRqPDEuKC/zxKoQIDAQABo1AwTjAdBgNVHQ4EFgQUDJdr9taJqUSJh0uX
9oanZJlx5ewwHwYDVR0jBBgwFoAUDJdr9taJqUSJh0uX9oanZJlx5ewwDAYDVR0T
BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEARGsherQt9G7xaZ/EKCarZDhOCVqV
UXSZ4vkIEdPsNpvsPq07MPlMt9dePvcrtwlpy9JzxT3YSDOkJGIL71WrzRr4xCSr
J9FqB64beHKjYgiZ1eJiLYveRBXBnDzpLfctjzT4r0xwnZjnFfbNHRnpO9tz4sc0
e80j3yG1968u+8LhShd3Jl/3AY/g3+VgzGuAPgLYzAObHigWS8yME9HPBBHAIeKx
kXwZ4hiDaBh6q3UXD0IgSp3V7izQK3ScM2PDyrFDsLEg+R7YdnofWCbMiTc3uEVC
q/+dXqnGIeBzb4BrV0iYsbxCEdR6b9cF2ACoycFSs5nFLxz906yAvdeoFA==
-----END CERTIFICATE----
NONCOMPLIANT

begin
  OpenSSL::X509::Certificate.new(compliant)
  puts 'Result 1: Correctly parses RFC-7468 compliant PEM.'
rescue
  puts 'Result 2: Incorrectly does not parse RFC-7468 compliant PEM.'
end

begin
  OpenSSL::X509::Certificate.new(noncompliant)
  puts 'Result 3: Incorrectly parses RFC-7468 non-compliant PEM.'
rescue
  puts 'Result 4: Correctly does not parse RFC-7468 non-compliant PEM.'
end
